#include "mbed.h"

PwmOut servo(D3);
BufferedSerial pc(USBTX, USBRX, 250000); // パソコンとのシリアル通信
CAN can(PA_11, PA_12, (int)1e6);
CANMessage msg;

int main()
{

    servo.period_ms(20);       // PWM周期を20ミリ秒（50Hz）に設定
    servo.pulsewidth_us(1500); // パルス幅を1.5ミリ秒に設定
    while (1)
    {
        if (pc.readable())
        {
            char buf;
            pc.read(&buf, sizeof(buf));

            if (buf == 'W' || buf == 'w') // 前進
            {
                servo.pulsewidth_us(1000); // サーボを0度に設定
                osDelay(0.5);              // 0.5秒待つ

                servo.pulsewidth_us(2000); // サーボを180度に設定
                osDelay(0.5);              // 0.5秒待つ
                ThisThread::sleep_for(30ms);
            }
        }
    }
}
